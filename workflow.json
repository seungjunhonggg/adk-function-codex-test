{
  "meta": {
    "name": "testtest",
    "description": "LOT 조회 → 시뮬레이션 예측 흐름, MCP/File Search는 에이전트 도구로 연결",
    "updated_at": "2025-12-25T11:51:57.559330Z"
  },
  "nodes": [
    {
      "id": "node-start",
      "type": "start",
      "subtype": "start",
      "execution_mode": "",
      "label": "Start",
      "keywords": [],
      "input_format": "",
      "output_format": "",
      "position": {
        "x": 80,
        "y": 160
      },
      "config": {
        "input_variables": [
          "input_as_text"
        ],
        "state_variables": [
          "conversation_history:text"
        ]
      }
    },
    {
      "id": "node-guardrail",
      "type": "guardrail",
      "subtype": "guardrail",
      "execution_mode": "",
      "label": "Guardrail",
      "keywords": [],
      "input_format": "",
      "output_format": "",
      "position": {
        "x": 280,
        "y": 160
      },
      "config": {
        "input": "input_as_text",
        "pii": true,
        "moderation": true,
        "jailbreak": true,
        "hallucination": false,
        "vector_store_id": ""
      }
    },
    {
      "id": "node-orchestrator",
      "type": "agent",
      "subtype": "orchestrator",
      "execution_mode": "handoff",
      "label": "Orchestrator Agent",
      "keywords": [
        "lot",
        "로트",
        "line",
        "라인",
        "status",
        "상태",
        "data",
        "데이터",
        "조회",
        "예측",
        "시뮬레이션",
        "simulation",
        "forecast",
        "what-if",
        "risk",
        "수율"
      ],
      "input_format": "user message (Korean)",
      "output_format": "routing decision + tool/agent call",
      "position": {
        "x": 520,
        "y": 160
      },
      "config": {
        "agent_profile": "orchestrator",
        "instructions": "You are the conversation lead for a manufacturing monitoring demo. Always respond in Korean with a warm, friendly tone. For casual chat (greetings, thanks, small talk, unrelated topics), reply naturally and briefly, and optionally offer help with LOT lookup or recommendation. Do not mention internal routing, tools, or intent labels. If the intent is unclear, ask one short clarifying question before calling tools. When the user wants process or LOT data, gather the minimum required info with a concise, professional question (for example LOT ID or key filters like line, status, date range, or conditions). If you have enough info, call the db_agent tool with the user message. When the user wants an adjacent model recommendation, call the simulation_agent tool with the user message to open the UI and extract any params. If both are requested, call db_agent first, then simulation_agent. After tool output, respond naturally in 1-3 sentences; translate the tool report into natural Korean. If the tool reports missing fields, ask a single clear question only for those fields. If the recommendation is complete, briefly summarize it and ask whether to run a prediction simulation. If the user agrees to run the prediction simulation (including short affirmatives like 네/응/그래/ok/yes), call the simulation_agent tool again with the confirmation so it can run the prediction step. Do not invent LOT IDs or parameters.",
        "include_chat_history": true,
        "response_format": "text",
        "verbosity": "medium",
        "summary": "off",
        "write_conversation_history": false
      }
    },
    {
      "id": "node-end",
      "type": "end",
      "subtype": "end",
      "execution_mode": "",
      "label": "End",
      "keywords": [],
      "input_format": "",
      "output_format": "",
      "position": {
        "x": 760,
        "y": 160
      },
      "config": {
        "return_type": "text",
        "schema": ""
      }
    },
    {
      "id": "node-db-agent",
      "type": "agent",
      "subtype": "db_agent",
      "execution_mode": "as_tool",
      "label": "DB Agent",
      "keywords": [
        "lot",
        "로트",
        "line",
        "라인",
        "status",
        "상태",
        "data",
        "데이터",
        "조회",
        "process",
        "공정"
      ],
      "input_format": "lot_id or line/status query",
      "output_format": "process rows + UI update",
      "position": {
        "x": 520,
        "y": 20
      },
      "config": {
        "agent_profile": "db_agent",
        "instructions": "You are an internal DB helper used by the orchestrator. Do not address the user directly. Always respond in Korean. If a LOT ID is present, call get_lot_info(lot_id, limit=12). If no LOT ID but the user mentions line/status/conditions, call get_process_data(query=original_message, limit=12). If required info is missing, do not ask the user; report missing fields. Do not invent LOT IDs or data. Prefer tool calls over direct answers. Return a compact JSON object with keys: status, summary, missing, next. status must be ok|missing|error. missing should be a comma-separated string or 'none'. next should be a short Korean follow-up question or 'none'.",
        "include_chat_history": true,
        "response_format": "text",
        "verbosity": "medium",
        "summary": "off",
        "write_conversation_history": false
      }
    },
    {
      "id": "node-sim-agent",
      "type": "agent",
      "subtype": "simulation_agent",
      "execution_mode": "as_tool",
      "label": "Simulation Agent",
      "keywords": [
        "예측",
        "시뮬레이션",
        "simulation",
        "forecast",
        "what-if",
        "risk",
        "리스크",
        "수율",
        "throughput"
      ],
      "input_format": "lot_id or temperature/voltage/size/capacity/production_mode",
      "output_format": "simulation result + UI update",
      "position": {
        "x": 520,
        "y": 300
      },
      "config": {
        "agent_profile": "simulation_agent",
        "instructions": "You are an internal recommendation helper used by the orchestrator. Do not address the user directly. Always respond in Korean. When the user requests an adjacent model recommendation, call open_simulation_form first to open the UI panel (unless it is already open). If a LOT ID is provided, call run_lot_simulation(lot_id). Otherwise collect the five required params: temperature, voltage, size, capacity, production_mode. If any params are provided, call update_simulation_params with those values or with message=original_message to extract. Do not ask the user directly; report missing fields. Never ask for values that are already filled. When all five params are available, call run_simulation. If the user confirms a prediction simulation (including short affirmatives like 네/응/그래/ok/yes) and a recommendation exists, call run_prediction_simulation. Return a compact JSON object with keys: status, summary, missing, next. status must be ok|missing|error. missing should be a comma-separated string or 'none'. next should be a short Korean follow-up question or 'none'.",
        "include_chat_history": true,
        "response_format": "text",
        "verbosity": "medium",
        "summary": "off",
        "write_conversation_history": false
      }
    },
    {
      "id": "node-file-search",
      "type": "file_search",
      "subtype": "file_search",
      "execution_mode": "",
      "label": "File Search",
      "keywords": [],
      "input_format": "query",
      "output_format": "results",
      "position": {
        "x": 520,
        "y": 420
      },
      "config": {
        "vector_store_id": "",
        "top_k": 3
      }
    },
    {
      "id": "node-mcp-db",
      "type": "mcp",
      "subtype": "process_db",
      "execution_mode": "",
      "label": "MCP: Process DB",
      "keywords": [],
      "input_format": "query",
      "output_format": "rows",
      "position": {
        "x": 760,
        "y": 20
      },
      "config": {
        "toolset": "process_db",
        "server_name": "process_db",
        "server_url": "",
        "auth_type": "none",
        "auth_token": "",
        "tool_names": [],
        "message": ""
      }
    },
    {
      "id": "node-mcp-sim",
      "type": "mcp",
      "subtype": "simulation",
      "execution_mode": "",
      "label": "MCP: Simulation",
      "keywords": [],
      "input_format": "params",
      "output_format": "result",
      "position": {
        "x": 760,
        "y": 300
      },
      "config": {
        "toolset": "simulation",
        "server_name": "simulation_api",
        "server_url": "",
        "auth_type": "none",
        "auth_token": "",
        "tool_names": [],
        "message": ""
      }
    },
    {
      "id": "node-mcp-ui",
      "type": "mcp",
      "subtype": "frontend_trigger",
      "execution_mode": "",
      "label": "MCP: Frontend Trigger",
      "keywords": [],
      "input_format": "message",
      "output_format": "ui_event",
      "position": {
        "x": 760,
        "y": 420
      },
      "config": {
        "toolset": "frontend_trigger",
        "server_name": "frontend_trigger",
        "server_url": "",
        "auth_type": "none",
        "auth_token": "",
        "tool_names": [],
        "message": ""
      }
    }
  ],
  "edges": [
    {
      "from": "node-start",
      "to": "node-guardrail",
      "from_port": "out",
      "to_port": "in",
      "kind": "flow"
    },
    {
      "from": "node-guardrail",
      "to": "node-orchestrator",
      "from_port": "pass",
      "to_port": "in",
      "kind": "flow"
    },
    {
      "from": "node-guardrail",
      "to": "node-end",
      "from_port": "fail",
      "to_port": "in",
      "kind": "flow"
    },
    {
      "from": "node-orchestrator",
      "to": "node-end",
      "from_port": "out",
      "to_port": "in",
      "kind": "flow"
    },
    {
      "from": "node-orchestrator",
      "to": "node-db-agent",
      "from_port": "out",
      "to_port": "in",
      "kind": "handoff"
    },
    {
      "from": "node-orchestrator",
      "to": "node-sim-agent",
      "from_port": "out",
      "to_port": "in",
      "kind": "handoff"
    },
    {
      "from": "node-orchestrator",
      "to": "node-file-search",
      "from_port": "out",
      "to_port": "in",
      "kind": "tool"
    },
    {
      "from": "node-db-agent",
      "to": "node-mcp-db",
      "from_port": "out",
      "to_port": "in",
      "kind": "tool"
    },
    {
      "from": "node-db-agent",
      "to": "node-mcp-ui",
      "from_port": "out",
      "to_port": "in",
      "kind": "tool"
    },
    {
      "from": "node-sim-agent",
      "to": "node-mcp-sim",
      "from_port": "out",
      "to_port": "in",
      "kind": "tool"
    },
    {
      "from": "node-sim-agent",
      "to": "node-mcp-ui",
      "from_port": "out",
      "to_port": "in",
      "kind": "tool"
    }
  ]
}